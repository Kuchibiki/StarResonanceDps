<UserControl
    x:Class="StarResonanceDpsAnalysis.WPF.Controls.SkillBreakdown.ChartPanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:lex="http://wpflocalizeextension.codeplex.com"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:oxy="http://oxyplot.org/wpf"
    d:DesignHeight="450"
    d:DesignWidth="400"
    mc:Ignorable="d">

    <UserControl.Resources>
        <Style x:Key="ChartCardBorder" TargetType="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="Padding" Value="20,16" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="BorderBrush" Value="#F0F0F0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect
                        BlurRadius="8"
                        Opacity="0.08"
                        ShadowDepth="2"
                        Color="#000000" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ChartTitle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#262626" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontFamily" Value="pack://application:,,,/Assets/Fonts/#HarmonyOS Sans SC" />
        </Style>

        <Style x:Key="ChartIcon" TargetType="Path">
            <Setter Property="Width" Value="16" />
            <Setter Property="Height" Value="16" />
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style x:Key="ChartSubTitle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#8C8C8C" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>
    </UserControl.Resources>

    <StackPanel>
        <!--  Real-time DPS Chart  -->
        <Border Style="{StaticResource ChartCardBorder}">
            <StackPanel>
                <Grid Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Path
                            Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"
                            Fill="#4C83FF"
                            Style="{StaticResource ChartIcon}" />
                        <TextBlock Style="{StaticResource ChartTitle}" Text="{Binding TimeSeriesTitle}" />
                    </StackPanel>
                    
                    <StackPanel
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <Button
                            Width="24"
                            Height="24"
                            Margin="2,0"
                            Command="{Binding ResetZoomCommand}"
                            Content="?"
                            Style="{StaticResource AntButtonStyle}"
                            ToolTip="{lex:Loc Key=SkillBreakdown_Tooltip_ResetZoom}" />
                        <Button
                            Width="24"
                            Height="24"
                            Margin="2,0"
                            Command="{Binding ZoomOutCommand}"
                            Content="-"
                            Style="{StaticResource AntButtonStyle}" />
                        <Button
                            Width="24"
                            Height="24"
                            Margin="2,0"
                            Command="{Binding ZoomInCommand}"
                            Content="+"
                            Style="{StaticResource AntButtonStyle}" />
                    </StackPanel>
                </Grid>
                <oxy:PlotView Height="200" Model="{Binding SeriesPlotModel}" />
            </StackPanel>
        </Border>

        <!--  Skill Damage Distribution Pie Chart  -->
        <Border Style="{StaticResource ChartCardBorder}">
            <StackPanel>
                <StackPanel Margin="0,0,0,16" Orientation="Horizontal">
                    <Path
                        Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 2.05c3.95.23 7.18 3.25 7.75 7.15h-7.75V4.05zM11 19.95c-3.95-.23-7.18-3.25-7.75-7.15h7.75v7.15zm-1-8.15H2.25c.57-3.9 3.8-6.92 7.75-7.15v7.15z"
                        Fill="#738192"
                        Style="{StaticResource ChartIcon}" />
                    <TextBlock Style="{StaticResource ChartTitle}" Text="{Binding PieChartTitle}" />
                </StackPanel>
                <oxy:PlotView Height="280" Model="{Binding PiePlotModel}" />
            </StackPanel>
        </Border>

        <!--  Hit Type Distribution  -->
        <Border Style="{StaticResource ChartCardBorder}">
            <StackPanel>
                <StackPanel Margin="0,0,0,16" Orientation="Horizontal">
                    <Path
                        Data="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8h2.8v6h-2.8z"
                        Fill="#738192"
                        Style="{StaticResource ChartIcon}" />
                    <TextBlock Style="{StaticResource ChartTitle}" Text="{Binding HitTypeChartTitle}" />
                </StackPanel>
                
                <!-- Custom Progress Bar UI -->
                <StackPanel Margin="0,8">
                    <!-- Lucky -->
                    <Grid Margin="0,0,0,16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock FontSize="13" FontWeight="SemiBold" Foreground="#64748B">
                                <Run Text="{lex:Loc Key=Common_HitType_Lucky}"/>
                                <Run Text=" (Lucky)" FontSize="12" Foreground="#94A3B8"/>
                            </TextBlock>
                            <TextBlock Grid.Column="1" Text="{Binding LuckyCount, StringFormat={}{0:N0}}" FontSize="13" FontWeight="Bold" Foreground="#1E293B"/>
                        </Grid>
                        <Grid Grid.Row="1" Height="8">
                            <Border Background="#F1F5F9" CornerRadius="4"/>
                            <Border Background="#FACC15" CornerRadius="4" HorizontalAlignment="Left">
                                <Border.Width>
                                    <MultiBinding Converter="{StaticResource PercentToWidthConverter}">
                                        <Binding Path="LuckyPercentage"/>
                                        <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Grid}"/>
                                    </MultiBinding>
                                </Border.Width>
                            </Border>
                        </Grid>
                    </Grid>

                    <!-- Crit -->
                    <Grid Margin="0,0,0,16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock FontSize="13" FontWeight="SemiBold" Foreground="#64748B">
                                <Run Text="{lex:Loc Key=Common_HitType_Critical}"/>
                                <Run Text=" (Crit)" FontSize="12" Foreground="#94A3B8"/>
                            </TextBlock>
                            <TextBlock Grid.Column="1" Text="{Binding CritCount, StringFormat={}{0:N0}}" FontSize="13" FontWeight="Bold" Foreground="#1E293B"/>
                        </Grid>
                        <Grid Grid.Row="1" Height="8">
                            <Border Background="#F1F5F9" CornerRadius="4"/>
                            <Border Background="#34D399" CornerRadius="4" HorizontalAlignment="Left">
                                <Border.Width>
                                    <MultiBinding Converter="{StaticResource PercentToWidthConverter}">
                                        <Binding Path="CritPercentage"/>
                                        <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Grid}"/>
                                    </MultiBinding>
                                </Border.Width>
                            </Border>
                        </Grid>
                    </Grid>

                    <!-- Normal -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock FontSize="13" FontWeight="SemiBold" Foreground="#64748B">
                                <Run Text="{lex:Loc Key=Common_HitType_Normal}"/>
                                <Run Text=" (Normal)" FontSize="12" Foreground="#94A3B8"/>
                            </TextBlock>
                            <TextBlock Grid.Column="1" Text="{Binding NormalCount, StringFormat={}{0:N0}}" FontSize="13" FontWeight="Bold" Foreground="#1E293B"/>
                        </Grid>
                        <Grid Grid.Row="1" Height="8">
                            <Border Background="#F1F5F9" CornerRadius="4"/>
                            <Border Background="#3B82F6" CornerRadius="4" HorizontalAlignment="Left">
                                <Border.Width>
                                    <MultiBinding Converter="{StaticResource PercentToWidthConverter}">
                                        <Binding Path="NormalPercentage"/>
                                        <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Grid}"/>
                                    </MultiBinding>
                                </Border.Width>
                            </Border>
                        </Grid>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </Border>
    </StackPanel>
</UserControl>
